<%
  modal_id ||= ""
  step_by_step = false if step_by_step.nil?
  remind_me_later = false if remind_me_later.nil?
  number_of_questions = @attempt_builder.answers.try(:size)
%>

<% if step_by_step %>
  <div class="survey-attempt-form">
    <%= form_for([@survey, @attempt_builder], data: {remote: remote}, url: rapidfire.survey_attempts_path(@survey, @attempt_builder)) do |f| %>
      <%- @attempt_builder.answers.each_with_index do |answer, i| %>
        <%= f.fields_for("#{answer.question.id}", answer) do |answer_form| %>
          <div id="survey_<%= @survey.id %>_<%= i %>" style="<%= i == 0 ? '' : 'display: none'; %>">
            <%= render_answer_form_helper(answer, answer_form, { counter: i + 1 }) %>
            <div class="pull-left">
              <%= link_to "previous".cms, "javascript:void(0);", class: "btn btn-primary survey-question-previous", data: { index: i, q_id: answer.question.id }, style: "#{i == 0 ? 'display: none' : ''}" %>
            </div>
            <div class="pull-right">
              <%= link_to "next".cms, "javascript:void(0);", class: "btn btn-primary survey-question-next", data: { index: i, q_id: answer.question.id, rules: answer.question.validation_rules.to_json, type: answer.question.type} %>
            </div>
          </div>
        <% end %>
      <% end %>
      <div class="pull-right">
        <%= f.submit submit_text, class: "btn btn-default", id: "survey_attempt_form_#{@survey.id}", style: "display: none" %>
        <%= link_to "remind_me_later".cms, "##{modal_id}", class: "btn btn-primary", data: { toggle: :modal } if remind_me_later %>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="survey-attempt-form">
    <h2><%= t('rapidfire.attempts.header') -%></h2>
    <p class="survey-title"><%= @survey.cms_introduction %></p>

    <%= form_for([@survey, @attempt_builder], data: {remote: remote}, url: rapidfire.survey_attempts_path(@survey, @attempt_builder)) do |f| %>
      <%- @attempt_builder.answers.each_with_index do |answer, i| %>
        <%= f.fields_for("#{answer.question.id}", answer) do |answer_form| %>
          <%= render_answer_form_helper(answer, answer_form, { counter: i + 1 }) %>
        <% end %>
      <% end %>
      <div class="pull-right">
        <%= f.submit submit_text,  :class => 'btn btn-default' %>
      </div>
    <% end %>
  </div>
<% end %>